<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Bloxybet MM2 Demo</title>

<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.6.0.min.js"></script>

<style>
body {
  margin: 0;
  background: #020617;
  color: white;
  font-family: Arial, sans-serif;
}

#topbar {
  height: 60px;
  background: #020617;
  border-bottom: 1px solid #1e293b;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
}

#container {
  display: flex;
  height: calc(100vh - 60px);
}

#chat {
  width: 25%;
  border-right: 1px solid #1e293b;
  display: flex;
  flex-direction: column;
}

#messages {
  flex: 1;
  overflow: auto;
  padding: 10px;
}

#chat input {
  padding: 10px;
  border: none;
}

#main {
  width: 75%;
  padding: 20px;
}

.match {
  border: 1px solid #1e293b;
  border-radius: 8px;
  padding: 10px;
  margin-bottom: 10px;
}

button {
  background: #2563eb;
  border: none;
  color: white;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
}

#coinflip {
  margin-top: 40px;
  text-align: center;
}

.coin {
  width: 140px;
  height: 140px;
  border-radius: 50%;
  background: linear-gradient(145deg,#facc15,#eab308);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 42px;
  margin: auto;
  animation: spin 2s linear;
}

@keyframes spin {
  from { transform: rotateY(0); }
  to { transform: rotateY(720deg); }
}
</style>
</head>

<body>

<div id="topbar">
  <div>
    Username:
    <input id="username" placeholder="Roblox adÄ±">
    <button onclick="login()">Login</button>
  </div>
  <button onclick="createMatch()">Create Match</button>
</div>

<div id="container">

  <div id="chat">
    <div id="messages"></div>
    <input id="chatInput" placeholder="Mesaj yaz..." />
  </div>

  <div id="main">
    <h2>Matches</h2>
    <div id="matches"></div>
    <div id="coinflip"></div>
  </div>

</div>

<script>
// ðŸ”‘ PUBNUB KEYS (BURAYI DEÄžÄ°ÅžTÄ°R)
const pubnub = new PubNub({
  publishKey: "pub-c-59b96e01-f4ca-486b-bde1-e3160adbc839",
  subscribeKey: "sub-c-3f46e9b1-23c3-4f38-8370-50666a4f1e57",
  uuid: "user_" + Math.random().toString(36).slice(2)
});

let username = "";
let matches = {};

// ðŸ“¡ SUBSCRIBE
pubnub.subscribe({
  channels: ["public-chat", "public-matches"]
});

// ðŸ‘‚ LISTENER
pubnub.addListener({
  message: event => {
    const msg = event.message;

    // CHAT
    if (event.channel === "public-chat") {
      document.getElementById("messages").innerHTML +=
        `<div><b>${msg.user}:</b> ${msg.text}</div>`;
    }

    // MATCH SYSTEM
    if (event.channel === "public-matches") {
      if (msg.type === "create") {
        matches[msg.id] = msg;
      }
      if (msg.type === "remove") {
        delete matches[msg.id];
      }
      renderMatches();
    }

    // COINFLIP
    if (event.channel.startsWith("match-") && msg.type === "coinflip") {
      showCoinflip(msg.result, msg.winner);
    }
  }
});

// LOGIN
function login() {
  username = document.getElementById("username").value;
  alert("Logged in as " + username);
}

// CHAT SEND
document.getElementById("chatInput").addEventListener("keypress", e => {
  if (e.key === "Enter") {
    pubnub.publish({
      channel: "public-chat",
      message: { user: username, text: e.target.value }
    });
    e.target.value = "";
  }
});

// CREATE MATCH
function createMatch() {
  const id = Date.now();

  pubnub.publish({
    channel: "public-matches",
    message: {
      type: "create",
      id,
      creator: username,
      item: "Blossom",
      value: 910
    }
  });
}

// RENDER MATCHES
function renderMatches() {
  const div = document.getElementById("matches");
  div.innerHTML = "";
  Object.values(matches).forEach(m => {
    div.innerHTML += `
      <div class="match">
        ${m.creator} - ${m.item} (${m.value})
        <br><br>
        <button onclick="joinMatch(${m.id})">Join</button>
        <button onclick="viewMatch(${m.id})">View</button>
      </div>
    `;
  });
}

// JOIN MATCH
function joinMatch(id) {
  pubnub.subscribe({ channels: ["match-" + id] });

  const result = Math.random() < 0.5 ? "H" : "T";

  pubnub.publish({
    channel: "match-" + id,
    message: {
      type: "coinflip",
      result,
      winner: result === "H" ? "Creator" : "Joiner"
    }
  });

  pubnub.publish({
    channel: "public-matches",
    message: { type: "remove", id }
  });
}

// VIEW MATCH
function viewMatch(id) {
  pubnub.subscribe({ channels: ["match-" + id] });
  alert("Now watching match " + id);
}

// SHOW COINFLIP
function showCoinflip(result, winner) {
  document.getElementById("coinflip").innerHTML = `
    <div class="coin">${result}</div>
    <h3>${winner} WON</h3>
  `;
}
</script>

</body>
</html>
